<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI TTS Pro - Enhanced Glassmorphism Edition</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 25%, #34d399 50%, #10b981 75%, #059669 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        /* Enhanced Glassmorphism Effects */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.15);
        }
        
        .glass-dark {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 12px 40px rgba(16, 185, 129, 0.2);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-4px);
            box-shadow: 0 16px 50px rgba(16, 185, 129, 0.25);
        }
        
        /* Floating Elements */
        .floating-orb {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            animation: float 6s ease-in-out infinite;
        }
        
        .orb-1 {
            width: 150px;
            height: 150px;
            top: 10%;
            right: 15%;
            animation-delay: 0s;
        }
        
        .orb-2 {
            width: 100px;
            height: 100px;
            bottom: 20%;
            left: 10%;
            animation-delay: 2s;
        }
        
        .orb-3 {
            width: 80px;
            height: 80px;
            top: 60%;
            right: 25%;
            animation-delay: 4s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(10px) rotate(240deg); }
        }
        
        /* Enhanced Button Styles */
        .btn-glass {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.8) 0%, rgba(6, 182, 212, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-glass:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(6, 182, 212, 0.9) 100%);
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.3);
        }
        
        .btn-glass:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-glass::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-glass:hover::before {
            left: 100%;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, rgba(13, 148, 136, 0.8) 0%, rgba(20, 184, 166, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.9) 0%, rgba(15, 118, 110, 0.9) 100%);
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(13, 148, 136, 0.3);
        }
        
        /* Enhanced Voice Selection Cards */
        .voice-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 8px;
        }
        
        .voice-card:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(16, 185, 129, 0.5);
            transform: scale(1.02);
        }
        
        .voice-card.selected {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.8);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        .voice-category {
            margin-bottom: 20px;
        }
        
        .voice-category-title {
            font-size: 13px;
            font-weight: 700;
            color: #059669;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(34, 197, 94, 0.15);
            backdrop-filter: blur(8px);
            border-radius: 8px;
            border-left: 3px solid #16a34a;
        }
        
        .voice-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .voice-details {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .voice-emoji {
            font-size: 20px;
            width: 32px;
            text-align: center;
        }
        
        .voice-text {
            flex: 1;
            min-width: 0;
        }
        
        .voice-name {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 2px;
        }
        
        .voice-meta {
            font-size: 11px;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* Loading Animations */
        .loading-overlay {
            background: rgba(16, 185, 129, 0.1);
            backdrop-filter: blur(30px);
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(255, 255, 255, 0.3);
            border-top: 6px solid rgba(16, 185, 129, 0.8);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Particle Animation */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: particle-float 8s infinite linear;
        }
        
        @keyframes particle-float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }
        
        /* Enhanced Input Styles */
        .glass-input {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(31, 41, 55, 0.9);
            transition: all 0.3s ease;
        }
        
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            outline: none;
        }
        
        .glass-input::placeholder {
            color: rgba(107, 114, 128, 0.7);
        }
        
        /* Text Gradient */
        .text-gradient {
            background: linear-gradient(135deg, #064e3b, #065f46, #047857);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Enhanced Notification */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 10000;
            max-width: 350px;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            animation: slideIn 0.3s ease-out;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-y: auto;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        
        .modal-overlay.show {
            display: flex !important;
            opacity: 1 !important;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            border: 1px solid rgba(34, 197, 94, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            max-width: 95vw;
            max-height: 90vh;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.95);
            transition: transform 0.2s ease-in-out;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(34, 197, 94, 0.1);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }
        
        .help-section {
            padding: 1.5rem;
            margin: 1rem;
            border-radius: 1rem;
            border: 1px solid;
        }
        
        /* Audio Player Enhancement */
        .audio-player {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Statistics Cards */
        .stats-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.2s ease;
        }
        
        .stats-card:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.15);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 185, 129, 0.7);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .glass {
                backdrop-filter: blur(15px);
                -webkit-backdrop-filter: blur(15px);
            }
            
            .floating-orb {
                display: none;
            }
            
            .modal-content {
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 16px;
                margin: 8px;
            }
            
            .voice-card {
                padding: 12px;
            }
            
            .notification {
                max-width: calc(100vw - 2rem);
            }
        }
        
        @media (max-width: 640px) {
            .modal-overlay {
                padding: 0;
            }
            
            .modal-content {
                border-radius: 0;
                max-height: 100vh;
                margin: 0;
            }
        }

        /* Heart beat animation */
        .heart-beat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="relative overflow-x-hidden">
    <!-- Floating Background Elements -->
    <div class="floating-orb orb-1"></div>
    <div class="floating-orb orb-2"></div>
    <div class="floating-orb orb-3"></div>
    
    <!-- Animated Particles -->
    <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
    <div class="particle" style="left: 30%; animation-delay: 4s;"></div>
    <div class="particle" style="left: 40%; animation-delay: 6s;"></div>
    <div class="particle" style="left: 50%; animation-delay: 1s;"></div>
    <div class="particle" style="left: 60%; animation-delay: 3s;"></div>
    <div class="particle" style="left: 70%; animation-delay: 5s;"></div>
    <div class="particle" style="left: 80%; animation-delay: 7s;"></div>
    <div class="particle" style="left: 90%; animation-delay: 2.5s;"></div>

    <!-- Enhanced Navigation -->
    <nav class="glass sticky top-0 z-40 rounded-b-3xl border-b border-white border-opacity-30">
        <div class="container mx-auto px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center space-x-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-emerald-400 to-cyan-500 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-microphone-alt text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gradient">AI TTS Pro</h1>
                        <p class="text-emerald-800 text-sm opacity-80">Enhanced Glassmorphism Edition</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="statsBtn" class="glass-card p-3 rounded-2xl text-blue-700 hover:text-blue-800 transition-all duration-200">
                        <i class="fas fa-chart-bar text-xl"></i>
                    </button>
                    <button id="helpBtn" class="glass-card p-3 rounded-2xl text-emerald-700 hover:text-emerald-800 transition-all duration-200">
                        <i class="fas fa-question-circle text-xl"></i>
                    </button>
                    <button id="settingsBtn" class="glass-card p-3 rounded-2xl text-emerald-700 hover:text-emerald-800 transition-all duration-200">
                        <i class="fas fa-cog text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-7xl">
        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
            
            <!-- Left Panel - Text Input -->
            <div class="xl:col-span-2 space-y-8">
                <!-- Text Input Section -->
                <div class="glass rounded-3xl p-8">
                    <div class="flex items-center mb-8">
                        <div class="w-12 h-12 glass-card rounded-2xl flex items-center justify-center mr-4">
                            <i class="fas fa-edit text-emerald-600 text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Text Input</h2>
                        <span id="textLimitIndicator" class="ml-auto text-sm text-gray-500">0 / 5000</span>
                    </div>
                    
                    <!-- Language Selection -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-3">Language</label>
                            <select id="languageSelect" class="w-full p-4 rounded-2xl glass-input transition-all duration-200">
                                <option value="si-LK">🇱🇰 Sinhala (Sri Lanka)</option>
                                <option value="en-US" selected>🇺🇸 English (US)</option>
                                <option value="en-GB">🇬🇧 English (UK)</option>
                                <option value="en-AU">🇦🇺 English (Australia)</option>
                                <option value="ta-IN">🇮🇳 Tamil (India)</option>
                                <option value="hi-IN">🇮🇳 Hindi (India)</option>
                                <option value="th-TH">🇹🇭 Thai (Thailand)</option>
                                <option value="vi-VN">🇻🇳 Vietnamese</option>
                                <option value="ko-KR">🇰🇷 Korean</option>
                                <option value="ja-JP">🇯🇵 Japanese</option>
                                <option value="fr-FR">🇫🇷 French</option>
                                <option value="de-DE">🇩🇪 German</option>
                                <option value="es-ES">🇪🇸 Spanish</option>
                                <option value="it-IT">🇮🇹 Italian</option>
                                <option value="pt-BR">🇧🇷 Portuguese</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-3">Voice Quality</label>
                            <select id="qualitySelect" class="w-full p-4 rounded-2xl glass-input transition-all duration-200">
                                <option value="premium">🌟 Premium Quality (30+ Voices)</option>
                                <option value="standard">⚡ Standard Quality</option>
                            </select>
                        </div>
                    </div>

                    <!-- Text Area -->
                    <div class="mb-8">
                        <label class="block text-gray-700 text-sm font-semibold mb-4">Enter Your Text</label>
                        <div class="relative">
                            <textarea 
                                id="textInput" 
                                placeholder="ඔබේ පෙළ මෙහි ලියන්න... / Enter your text here..."
                                maxlength="5000"
                                class="w-full h-48 p-6 rounded-2xl glass-input resize-none transition-all duration-200 text-gray-800 placeholder-gray-500"
                            ></textarea>
                            <div class="absolute bottom-4 right-4 glass-card px-3 py-2 rounded-xl text-xs text-gray-600">
                                <span id="charCount">0 characters</span> • <span id="wordCount">0 words</span>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Quick Templates -->
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-4">Quick Templates</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <button class="template-btn glass-card p-4 rounded-2xl text-emerald-700 text-sm font-medium transition-all duration-200" data-text="ආයුබෝවන්! ඔබට සුභ දිනයක් වේවා! අපගේ නව AI TTS සේවාවට සාදරයෙන් පිළිගන්නවා.">
                                <i class="fas fa-globe mr-2"></i>Sinhala Greeting
                            </button>
                            <button class="template-btn glass-card p-4 rounded-2xl text-emerald-700 text-sm font-medium transition-all duration-200" data-text="Hello and welcome! This is our advanced AI-powered text-to-speech system with over 30 premium voices.">
                                <i class="fas fa-hand-wave mr-2"></i>English Greeting
                            </button>
                            <button class="template-btn glass-card p-4 rounded-2xl text-emerald-700 text-sm font-medium transition-all duration-200" data-text="This is a comprehensive test of our enhanced text-to-speech system featuring Gemini AI with premium voice quality.">
                                <i class="fas fa-vial mr-2"></i>Test Message
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Advanced Settings -->
                <div class="glass rounded-3xl p-8">
                    <div class="flex items-center mb-8">
                        <div class="w-12 h-12 glass-card rounded-2xl flex items-center justify-center mr-4">
                            <i class="fas fa-sliders-h text-cyan-600 text-xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800">Advanced Settings</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-4">Speech Rate</label>
                            <input type="range" id="speechRate" min="-50" max="50" value="0" class="w-full h-3 bg-white bg-opacity-30 rounded-full appearance-none cursor-pointer">
                            <span id="rateValue" class="text-gray-600 text-sm mt-2 block text-center">Normal (0%)</span>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-4">Pitch</label>
                            <input type="range" id="speechPitch" min="-20" max="20" value="0" class="w-full h-3 bg-white bg-opacity-30 rounded-full appearance-none cursor-pointer">
                            <span id="pitchValue" class="text-gray-600 text-sm mt-2 block text-center">Normal (0Hz)</span>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-4">Expressiveness</label>
                            <input type="range" id="temperature" min="0.1" max="2.0" step="0.1" value="1.0" class="w-full h-3 bg-white bg-opacity-30 rounded-full appearance-none cursor-pointer">
                            <span id="tempValue" class="text-gray-600 text-sm mt-2 block text-center">1.0</span>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-white border-opacity-20">
                        <div class="flex flex-wrap gap-6">
                            <label class="flex items-center text-gray-700 cursor-pointer glass-card p-3 rounded-xl">
                                <input type="checkbox" id="enhanceAudio" class="w-5 h-5 text-emerald-600 bg-white bg-opacity-50 border-emerald-300 rounded focus:ring-emerald-500 focus:ring-2">
                                <span class="ml-3 text-sm font-medium">Audio Enhancement</span>
                            </label>
                            <label class="flex items-center text-gray-700 cursor-pointer glass-card p-3 rounded-xl">
                                <input type="checkbox" id="highQuality" class="w-5 h-5 text-emerald-600 bg-white bg-opacity-50 border-emerald-300 rounded focus:ring-emerald-500 focus:ring-2">
                                <span class="ml-3 text-sm font-medium">High Quality Output</span>
                            </label>
                            <label class="flex items-center text-gray-700 cursor-pointer glass-card p-3 rounded-xl">
                                <input type="checkbox" id="autoPlay" class="w-5 h-5 text-emerald-600 bg-white bg-opacity-50 border-emerald-300 rounded focus:ring-emerald-500 focus:ring-2">
                                <span class="ml-3 text-sm font-medium">Auto Play</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Controls -->
            <div class="space-y-8">
                <!-- Enhanced Voice Selection -->
                <div class="glass rounded-3xl p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 glass-card rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-user-friends text-emerald-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Voice Selection</h3>
                        <span id="voiceCount" class="ml-auto text-xs bg-emerald-100 text-emerald-800 px-2 py-1 rounded-full">30+</span>
                    </div>
                    
                    <!-- Voice Search -->
                    <div class="mb-4 glass-card p-3 rounded-lg">
                        <input type="text" id="voiceSearch" placeholder="Search voices..." 
                               class="w-full p-2 text-sm rounded-lg bg-white/70 border-none text-gray-700 placeholder-gray-500 focus:outline-none">
                    </div>
                    
                    <div id="voiceContainer" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Voice options will be populated here -->
                    </div>
                </div>

                <!-- Generation Controls -->
                <div class="glass rounded-3xl p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 glass-card rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-play text-emerald-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Generate</h3>
                    </div>
                    
                    <button id="generateBtn" class="w-full btn-glass py-4 px-6 rounded-2xl text-lg font-semibold mb-4">
                        <i class="fas fa-magic mr-3"></i>
                        <span id="generateBtnText">Generate Speech</span>
                    </button>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <select id="formatSelect" class="glass-input p-3 rounded-xl text-sm">
                            <option value="wav">WAV (High Quality)</option>
                            <option value="mp3">MP3 (Compressed)</option>
                            <option value="ogg">OGG (Open Source)</option>
                            <option value="flac">FLAC (Lossless)</option>
                        </select>
                        <button id="clearBtn" class="glass-card text-gray-700 py-3 px-4 rounded-xl text-sm font-medium hover:bg-white hover:bg-opacity-40">
                            <i class="fas fa-trash mr-2"></i>Clear
                        </button>
                    </div>
                    
                    <button id="batchBtn" class="w-full btn-secondary text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200">
                        <i class="fas fa-layer-group mr-2"></i>Batch Process
                    </button>
                    
                    <div id="progressContainer" class="hidden mt-4">
                        <div class="bg-white bg-opacity-30 rounded-full h-3 mb-2">
                            <div id="progressBar" class="bg-gradient-to-r from-emerald-500 to-cyan-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="text-gray-600 text-sm text-center">Processing...</p>
                    </div>
                </div>

                <!-- Enhanced Audio Player -->
                <div id="audioPlayerContainer" class="glass rounded-3xl p-6 hidden">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 glass-card rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-volume-up text-cyan-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Audio Player</h3>
                    </div>
                    
                    <div class="audio-player mb-4">
                        <audio id="audioPlayer" controls class="w-full">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <button id="downloadBtn" class="btn-glass py-3 px-4 rounded-xl text-sm font-semibold">
                            <i class="fas fa-download mr-2"></i>Download
                        </button>
                        <button id="shareBtn" class="glass-card text-gray-700 py-3 px-4 rounded-xl text-sm font-medium hover:bg-white hover:bg-opacity-40">
                            <i class="fas fa-share mr-2"></i>Share
                        </button>
                    </div>
                    
                    <div id="audioInfo" class="glass-card p-4 rounded-xl text-gray-600 text-sm">
                        <!-- Audio information will be displayed here -->
                    </div>
                </div>

                <!-- Recent History -->
                <div class="glass rounded-3xl p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 glass-card rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-history text-emerald-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Recent</h3>
                    </div>
                    
                    <div id="recentList" class="space-y-3 max-h-64 overflow-y-auto">
                        <p class="text-gray-500 text-sm italic text-center py-8">No recent generations</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Statistics Panel -->
        <div class="mt-8">
            <div class="bg-gradient-to-r from-transparent via-white/30 to-transparent h-px mb-8"></div>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="stats-card rounded-xl p-5 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-emerald-600 mb-2" id="totalGenerations">0</div>
                    <div class="text-gray-600 text-xs sm:text-sm font-medium">Generations</div>
                </div>
                <div class="stats-card rounded-xl p-5 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-cyan-600 mb-2" id="totalDuration">0s</div>
                    <div class="text-gray-600 text-xs sm:text-sm font-medium">Duration</div>
                </div>
                <div class="stats-card rounded-xl p-5 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-teal-600 mb-2" id="favoriteVoice">-</div>
                    <div class="text-gray-600 text-xs sm:text-sm font-medium">Top Voice</div>
                </div>
                <div class="stats-card rounded-xl p-5 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-lime-600 mb-2" id="successRate">100%</div>
                    <div class="text-gray-600 text-xs sm:text-sm font-medium">Success Rate</div>
                </div>
                <div class="stats-card rounded-xl p-5 text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-blue-600 mb-2" id="errorCount">0</div>
                    <div class="text-gray-600 text-xs sm:text-sm font-medium">Errors</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Footer -->
    <footer class="mt-16 bg-gradient-to-r from-emerald-800 via-teal-800 to-cyan-800">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <p class="text-emerald-100 text-sm mb-2">
                    Made with <span class="text-red-400 heart-beat inline-block">♥</span> by 
                    <span class="font-semibold text-white">Ashen</span>
                </p>
                <p class="text-emerald-200 text-xs">
                    Enhanced Glassmorphism Edition • 30+ Premium Gemini Voices • Advanced AI Technology
                </p>
            </div>
        </div>
    </footer>

    <!-- Enhanced Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 loading-overlay z-50 hidden flex items-center justify-center">
        <div class="glass-dark rounded-3xl p-12 max-w-md mx-4 text-center">
            <div class="relative mb-8">
                <div class="loading-spinner mx-auto"></div>
            </div>
            
            <h3 class="text-white text-xl font-bold mb-3">Generating Speech</h3>
            <p id="loadingText" class="text-gray-200 mb-6">Processing your text...</p>
            
            <div class="flex justify-center space-x-2">
                <div class="w-3 h-3 bg-emerald-400 rounded-full animate-pulse"></div>
                <div class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                <div class="w-3 h-3 bg-emerald-600 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
            </div>
        </div>
    </div>

    <!-- Enhanced Notifications -->
    <div id="notification" class="notification rounded-2xl card-shadow">
        <div class="p-4">
            <div class="flex items-start">
                <i id="notificationIcon" class="text-2xl mr-3 mt-1"></i>
                <div class="flex-1">
                    <h4 id="notificationTitle" class="text-gray-800 font-semibold text-sm"></h4>
                    <p id="notificationMessage" class="text-gray-600 text-xs mt-1"></p>
                </div>
                <button id="notificationClose" class="text-gray-400 hover:text-gray-600 ml-3">
                    <i class="fas fa-times text-sm"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Help Modal -->
    <div id="helpModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Help & Guide</h2>
                    <button id="closeHelp" class="text-gray-400 hover:text-gray-600 text-2xl p-2 hover:bg-gray-100 rounded-lg transition-all duration-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="modal-body">
                <div class="p-6 space-y-5">
                    
                    <section class="help-section bg-emerald-50 border border-emerald-200 rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3 text-emerald-800 flex items-center">
                            <i class="fas fa-play-circle mr-2"></i>Quick Start
                        </h3>
                        <div class="space-y-2 text-sm text-emerald-700">
                            <p><strong>1.</strong> Select language from 15+ supported options</p>
                            <p><strong>2.</strong> Enter your text (max 5,000 characters)</p>
                            <p><strong>3.</strong> Choose from 30+ premium Gemini voices</p>
                            <p><strong>4.</strong> Click "Generate Speech" and download</p>
                        </div>
                    </section>
                    
                    <section class="help-section bg-blue-50 border border-blue-200 rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3 text-blue-800 flex items-center">
                            <i class="fas fa-microphone mr-2"></i>Premium Gemini Voices
                        </h3>
                        <div class="text-sm text-blue-700">
                            <p><strong>30+ Premium Voices:</strong> Including Core, Stellar, Constellation, Mythological, Cosmic, and Zodiacal collections</p>
                            <p><strong>Quality:</strong> Ultra-high quality AI-generated speech with natural expressiveness</p>
                        </div>
                    </section>
                    
                    <section class="help-section bg-purple-50 border border-purple-200 rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3 text-purple-800 flex items-center">
                            <i class="fas fa-language mr-2"></i>Supported Languages
                        </h3>
                        <div class="text-sm text-purple-700">
                            <p><strong>15+ Languages:</strong> 🇱🇰 Sinhala, 🇺🇸 English, 🇮🇳 Tamil/Hindi, 🇯🇵 Japanese, 🇰🇷 Korean, 🇫🇷 French, 🇩🇪 German, 🇪🇸 Spanish, 🇮🇹 Italian, 🇧🇷 Portuguese, 🇹🇭 Thai, 🇻🇳 Vietnamese + more</p>
                        </div>
                    </section>
                    
                    <section class="help-section bg-teal-50 border border-teal-200 rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3 text-teal-800 flex items-center">
                            <i class="fas fa-sliders-h mr-2"></i>Advanced Controls
                        </h3>
                        <div class="grid grid-cols-2 gap-3 text-sm text-teal-700">
                            <div>
                                <p><strong>Speech Rate:</strong> -50% to +50%</p>
                                <p><strong>Pitch:</strong> ±20Hz adjustment</p>
                            </div>
                            <div>
                                <p><strong>Expressiveness:</strong> 0.1-2.0 range</p>
                                <p><strong>Formats:</strong> WAV, MP3, OGG, FLAC</p>
                            </div>
                        </div>
                    </section>
                    
                    <section class="help-section bg-orange-50 border border-orange-200 rounded-xl p-4">
                        <h3 class="text-lg font-semibold mb-3 text-orange-800 flex items-center">
                            <i class="fas fa-keyboard mr-2"></i>Keyboard Shortcuts
                        </h3>
                        <div class="text-sm text-orange-700 space-y-1">
                            <p><kbd class="bg-white px-2 py-1 rounded text-xs">Ctrl + Enter</kbd> Generate speech</p>
                            <p><kbd class="bg-white px-2 py-1 rounded text-xs">Escape</kbd> Close help/modals</p>
                            <p><kbd class="bg-white px-2 py-1 rounded text-xs">Ctrl + ?</kbd> Open help</p>
                        </div>
                    </section>
                    
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Application State
        let appState = {
            currentAudio: null,
            recentGenerations: [],
            stats: {
                totalGenerations: 0,
                totalDuration: 0,
                favoriteVoice: null,
                successRate: 100,
                errorCount: 0
            },
            currentVoices: {},
            filters: {
                search: '',
                engine: 'gemini'
            },
            isGenerating: false
        };

        // COMPLETE GEMINI VOICE CONFIGURATIONS (30+ Voices) - EDGE REMOVED
        const voiceConfigs = {
            // Core Premium Voices
            'Zephyr': { gender: 'neutral', style: 'warm', emoji: '🌬️', quality: 'premium', category: 'Core' },
            'Puck': { gender: 'neutral', style: 'friendly', emoji: '😊', quality: 'premium', category: 'Core' },
            'Aoede': { gender: 'female', style: 'professional', emoji: '👩‍💼', quality: 'premium', category: 'Core' },
            'Charon': { gender: 'male', style: 'authoritative', emoji: '👨‍💼', quality: 'premium', category: 'Core' },
            'Fenrir': { gender: 'male', style: 'deep', emoji: '🐺', quality: 'premium', category: 'Core' },
            'Kore': { gender: 'female', style: 'gentle', emoji: '🌸', quality: 'premium', category: 'Core' },
            
            // Extended Collection
            'Leda': { gender: 'female', style: 'elegant', emoji: '🦢', quality: 'premium', category: 'Mythological' },
            'Orus': { gender: 'male', style: 'strong', emoji: '⛰️', quality: 'premium', category: 'Mythological' },
            'Callirrhoe': { gender: 'female', style: 'melodic', emoji: '🎵', quality: 'premium', category: 'Mythological' },
            'Autonoe': { gender: 'female', style: 'natural', emoji: '🍃', quality: 'premium', category: 'Mythological' },
            'Enceladus': { gender: 'neutral', style: 'cosmic', emoji: '🌌', quality: 'premium', category: 'Cosmic' },
            'Iapetus': { gender: 'male', style: 'mysterious', emoji: '🌙', quality: 'premium', category: 'Cosmic' },
            'Umbriel': { gender: 'neutral', style: 'shadowy', emoji: '🌘', quality: 'premium', category: 'Cosmic' },
            
            // Stellar Series
            'Algieba': { gender: 'female', style: 'bright', emoji: '⭐', quality: 'premium', category: 'Stellar' },
            'Despina': { gender: 'female', style: 'oceanic', emoji: '🌊', quality: 'premium', category: 'Stellar' },
            'Erinome': { gender: 'female', style: 'classical', emoji: '🏛️', quality: 'premium', category: 'Stellar' },
            'Algenib': { gender: 'neutral', style: 'stellar', emoji: '✨', quality: 'premium', category: 'Stellar' },
            'Rasalgethi': { gender: 'male', style: 'royal', emoji: '👑', quality: 'premium', category: 'Stellar' },
            'Laomedeia': { gender: 'female', style: 'mythical', emoji: '🏺', quality: 'premium', category: 'Stellar' },
            
            // Constellation Collection
            'Achernar': { gender: 'neutral', style: 'swift', emoji: '💫', quality: 'premium', category: 'Constellation' },
            'Alnilam': { gender: 'male', style: 'brilliant', emoji: '💎', quality: 'premium', category: 'Constellation' },
            'Schedar': { gender: 'female', style: 'regal', emoji: '💃', quality: 'premium', category: 'Constellation' },
            'Gacrux': { gender: 'neutral', style: 'southern', emoji: '🌟', quality: 'premium', category: 'Constellation' },
            'Pulcherrima': { gender: 'female', style: 'beautiful', emoji: '🌺', quality: 'premium', category: 'Constellation' },
            'Achird': { gender: 'neutral', style: 'binary', emoji: '👥', quality: 'premium', category: 'Constellation' },
            
            // Zodiacal Collection
            'Zubenelgenubi': { gender: 'male', style: 'balanced', emoji: '⚖️', quality: 'premium', category: 'Zodiacal' },
            'Vindemiatrix': { gender: 'female', style: 'harvest', emoji: '🍇', quality: 'premium', category: 'Zodiacal' },
            'Sadachbia': { gender: 'neutral', style: 'aqueous', emoji: '🌊', quality: 'premium', category: 'Zodiacal' },
            'Sadaltager': { gender: 'male', style: 'fortunate', emoji: '🍀', quality: 'premium', category: 'Zodiacal' },
            'Sulafat': { gender: 'female', style: 'celestial', emoji: '🌙', quality: 'premium', category: 'Zodiacal' }
        };

        // DOM Elements
        const elements = {
            textInput: document.getElementById('textInput'),
            languageSelect: document.getElementById('languageSelect'),
            voiceContainer: document.getElementById('voiceContainer'),
            voiceSearch: document.getElementById('voiceSearch'),
            generateBtn: document.getElementById('generateBtn'),
            generateBtnText: document.getElementById('generateBtnText'),
            batchBtn: document.getElementById('batchBtn'),
            audioPlayer: document.getElementById('audioPlayer'),
            audioPlayerContainer: document.getElementById('audioPlayerContainer'),
            downloadBtn: document.getElementById('downloadBtn'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            progressContainer: document.getElementById('progressContainer'),
            progressBar: document.getElementById('progressBar'),
            notification: document.getElementById('notification'),
            helpModal: document.getElementById('helpModal'),
            recentList: document.getElementById('recentList'),
            textLimitIndicator: document.getElementById('textLimitIndicator'),
            voiceCount: document.getElementById('voiceCount'),
            clearBtn: document.getElementById('clearBtn')
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            updateVoiceOptions();
            loadUserPreferences();
            showWelcomeMessage();
        });

        function initializeApp() {
            // Batch DOM updates for better performance
            requestAnimationFrame(() => {
                updateTextStats();
                updateRangeValues();
                loadRecentGenerations();
                updateStatistics();
                
                // Ensure modal is hidden on load
                if (elements.helpModal) {
                    elements.helpModal.style.display = 'none';
                    elements.helpModal.classList.remove('show');
                }
            });
            
            // Auto-refresh statistics every 30 seconds
            setInterval(updateStatistics, 30000);
        }

        function setupEventListeners() {
            // Text input events
            elements.textInput.addEventListener('input', updateTextStats);
            
            // Template buttons
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    elements.textInput.value = this.dataset.text;
                    updateTextStats();
                    showNotification('info', 'Template Loaded', 'Text template has been loaded successfully.');
                    
                    // Visual feedback
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => this.style.transform = 'scale(1)', 150);
                });
            });

            // Voice search with debouncing
            elements.voiceSearch.addEventListener('input', debounce(filterVoices, 300));

            // Range inputs
            document.getElementById('speechRate').addEventListener('input', updateRangeValues);
            document.getElementById('speechPitch').addEventListener('input', updateRangeValues);
            document.getElementById('temperature').addEventListener('input', updateRangeValues);

            // Main buttons
            elements.generateBtn.addEventListener('click', generateSpeech);
            elements.batchBtn.addEventListener('click', showBatchModal);
            elements.clearBtn.addEventListener('click', clearAll);
            document.getElementById('statsBtn').addEventListener('click', fetchStatistics);

            // Modal events
            document.getElementById('helpBtn').addEventListener('click', function(e) {
                e.preventDefault();
                showHelpModal();
            });
            
            document.getElementById('closeHelp').addEventListener('click', function(e) {
                e.preventDefault();
                hideHelpModal();
            });
            
            // Click outside modal to close
            elements.helpModal.addEventListener('click', function(e) {
                if (e.target === elements.helpModal) {
                    hideHelpModal();
                }
            });

            // Prevent modal content clicks from closing modal
            elements.helpModal.querySelector('.modal-content').addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // Notification close
            document.getElementById('notificationClose').addEventListener('click', hideNotification);

            // Download and share
            elements.downloadBtn.addEventListener('click', downloadAudio);
            document.getElementById('shareBtn').addEventListener('click', shareAudio);
            
            // Ensure download button works for each generation
            elements.downloadBtn.onclick = downloadAudio;

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        function updateTextStats() {
            const text = elements.textInput.value;
            const charCount = text.length;
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            const maxLength = 5000;
            
            document.getElementById('charCount').textContent = `${charCount} characters`;
            document.getElementById('wordCount').textContent = `${wordCount} words`;
            elements.textLimitIndicator.textContent = `${charCount} / ${maxLength}`;
            
            // Color coding for limit
            if (charCount > maxLength * 0.9) {
                elements.textLimitIndicator.classList.add('text-red-500');
                elements.textLimitIndicator.classList.remove('text-gray-500', 'text-yellow-500');
            } else if (charCount > maxLength * 0.7) {
                elements.textLimitIndicator.classList.add('text-yellow-500');
                elements.textLimitIndicator.classList.remove('text-gray-500', 'text-red-500');
            } else {
                elements.textLimitIndicator.classList.add('text-gray-500');
                elements.textLimitIndicator.classList.remove('text-yellow-500', 'text-red-500');
            }
        }

        function updateRangeValues() {
            const rate = document.getElementById('speechRate').value;
            const pitch = document.getElementById('speechPitch').value;
            const temp = document.getElementById('temperature').value;
            
            document.getElementById('rateValue').textContent = `${rate > 0 ? '+' : ''}${rate}%`;
            document.getElementById('pitchValue').textContent = `${pitch > 0 ? '+' : ''}${pitch}Hz`;
            document.getElementById('tempValue').textContent = temp;
        }

        function updateVoiceOptions() {
            const voices = voiceConfigs;
            appState.currentVoices = voices;
            
            renderVoices(voices);
            elements.voiceCount.textContent = Object.keys(voices).length;
        }

        function renderVoices(voices) {
            // Clear container efficiently
            elements.voiceContainer.innerHTML = '';
            
            const fragment = document.createDocumentFragment();
            
            // Group voices by category for better organization
            const categories = {
                'Core': [],
                'Stellar': [],
                'Constellation': [],
                'Mythological': [],
                'Cosmic': [],
                'Zodiacal': []
            };
            
            Object.entries(voices).forEach(([voiceName, config]) => {
                const category = config.category || 'Core';
                if (categories[category]) {
                    categories[category].push([voiceName, config]);
                }
            });
            
            // Render categories that have voices
            Object.entries(categories).forEach(([category, categoryVoices]) => {
                if (categoryVoices.length > 0) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'voice-category';
                    
                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'voice-category-title';
                    titleDiv.textContent = `${category} Collection`;
                    categoryDiv.appendChild(titleDiv);
                    
                    // Add voice cards
                    categoryVoices.forEach(([voiceName, config]) => {
                        categoryDiv.appendChild(createVoiceCard(voiceName, config));
                    });
                    
                    fragment.appendChild(categoryDiv);
                }
            });
            
            elements.voiceContainer.appendChild(fragment);
            
            // Select first voice by default
            const firstVoiceCard = elements.voiceContainer.querySelector('.voice-card');
            if (firstVoiceCard) {
                requestAnimationFrame(() => {
                    firstVoiceCard.click();
                });
            }
        }

        function createVoiceCard(voiceName, config) {
            const voiceCard = document.createElement('div');
            voiceCard.className = 'voice-card';
            voiceCard.dataset.voiceName = voiceName;
            
            voiceCard.innerHTML = `
                <div class="voice-info">
                    <div class="voice-details">
                        <span class="voice-emoji">${config.emoji}</span>
                        <div class="voice-text">
                            <div class="voice-name">${voiceName}</div>
                            <div class="voice-meta">
                                <span>${config.gender}</span>
                                <span>•</span>
                                <span>${config.style}</span>
                            </div>
                        </div>
                    </div>
                    <input type="radio" name="voice" value="${voiceName}" class="w-4 h-4 text-emerald-600 bg-white border-emerald-300 focus:ring-emerald-500 focus:ring-2 flex-shrink-0">
                </div>
            `;
            
            voiceCard.addEventListener('click', (e) => {
                e.preventDefault();
                selectVoice(voiceCard, voiceName);
            });
            
            return voiceCard;
        }

        function selectVoice(card, voiceName) {
            // Remove selection from all cards
            document.querySelectorAll('.voice-card').forEach(c => {
                c.classList.remove('selected');
                c.querySelector('input[type="radio"]').checked = false;
            });
            
            // Add selection to clicked card
            card.classList.add('selected');
            card.querySelector('input[type="radio"]').checked = true;
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function filterVoices() {
            const searchTerm = elements.voiceSearch.value.toLowerCase();
            appState.filters.search = searchTerm;
            
            const voices = appState.currentVoices;
            const filteredVoices = {};
            
            Object.entries(voices).forEach(([voiceName, config]) => {
                if (voiceName.toLowerCase().includes(searchTerm) || 
                    config.style?.toLowerCase().includes(searchTerm) ||
                    config.category?.toLowerCase().includes(searchTerm) ||
                    config.gender?.toLowerCase().includes(searchTerm)) {
                    filteredVoices[voiceName] = config;
                }
            });
            
            renderVoices(filteredVoices);
        }

        async function generateSpeech() {
            const text = elements.textInput.value.trim();
            if (!text) {
                showNotification('error', 'Error', 'Please enter some text to generate speech.');
                return;
            }

            if (text.length > 5000) {
                showNotification('error', 'Text Too Long', `Text must be under 5,000 characters. Current: ${text.length}`);
                return;
            }

            const selectedVoice = document.querySelector('input[name="voice"]:checked');
            if (!selectedVoice) {
                showNotification('error', 'Error', 'Please select a voice.');
                return;
            }

            if (appState.isGenerating) return;

            appState.isGenerating = true;
            elements.generateBtn.disabled = true;
            elements.generateBtnText.textContent = 'Generating...';
            showLoading(true);
            showProgress(true);

            try {
                const requestData = {
                    text: text,
                    engine: 'gemini', // Only Gemini now
                    voice: selectedVoice.value,
                    language: elements.languageSelect.value,
                    rate: `${document.getElementById('speechRate').value > 0 ? '+' : ''}${document.getElementById('speechRate').value}%`,
                    pitch: `${document.getElementById('speechPitch').value > 0 ? '+' : ''}${document.getElementById('speechPitch').value}Hz`,
                    temperature: parseFloat(document.getElementById('temperature').value),
                    enhance: document.getElementById('enhanceAudio').checked,
                    format: document.getElementById('formatSelect').value,
                    quality: document.getElementById('highQuality').checked ? 'high' : 'standard'
                };

                // Simulate API call with realistic timing
                const result = await simulateApiCall(requestData);
                
                if (result.success) {
                    handleSuccessfulGeneration(result, text, selectedVoice.value);
                    showNotification('success', 'Success!', 'Speech generated successfully.');
                } else {
                    throw new Error(result.error || 'Generation failed');
                }

            } catch (error) {
                console.error('Generation error:', error);
                appState.stats.errorCount++;
                showNotification('error', 'Generation Failed', error.message);
            } finally {
                appState.isGenerating = false;
                showLoading(false);
                showProgress(false);
                elements.generateBtn.disabled = false;
                elements.generateBtnText.textContent = 'Generate Speech';
                updateStatistics();
            }
        }

        function generateDemoAudio() {
            try {
                // Create a simple demo audio tone
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const sampleRate = audioContext.sampleRate;
                const duration = 2; // 2 seconds
                const length = sampleRate * duration;
                const buffer = audioContext.createBuffer(1, length, sampleRate);
                const data = buffer.getChannelData(0);
                
                // Generate a pleasant tone sequence
                for (let i = 0; i < length; i++) {
                    const t = i / sampleRate;
                    // Create a melody with multiple frequencies
                    const freq1 = 440; // A4
                    const freq2 = 523.25; // C5
                    const freq3 = 659.25; // E5
                    
                    let sample = 0;
                    sample += Math.sin(2 * Math.PI * freq1 * t) * 0.3 * Math.exp(-t * 2);
                    sample += Math.sin(2 * Math.PI * freq2 * t) * 0.2 * Math.exp(-t * 1.5);
                    sample += Math.sin(2 * Math.PI * freq3 * t) * 0.1 * Math.exp(-t * 1);
                    
                    data[i] = sample * Math.exp(-t * 0.5); // Fade out
                }
                
                // Convert to WAV and create blob URL
                const wavBlob = audioBufferToWav(buffer);
                return URL.createObjectURL(wavBlob);
            } catch (error) {
                console.error('Audio generation failed:', error);
                // Fallback: return a data URL with a simple beep
                return 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBgAAA';
            }
        }
        
        function audioBufferToWav(buffer) {
            const length = buffer.length;
            const arrayBuffer = new ArrayBuffer(44 + length * 2);
            const view = new DataView(arrayBuffer);
            const channels = 1;
            const sampleRate = buffer.sampleRate;
            
            // WAV header
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, channels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, length * 2, true);
            
            // Convert float samples to 16-bit PCM
            const data = buffer.getChannelData(0);
            let offset = 44;
            for (let i = 0; i < length; i++) {
                const sample = Math.max(-1, Math.min(1, data[i]));
                view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
                offset += 2;
            }
            
            return new Blob([arrayBuffer], { type: 'audio/wav' });
        }
            // Enhanced simulation with better realism
            return new Promise((resolve, reject) => {
                const processingTime = Math.random() * 2000 + 3000; // 3-5 seconds
                
                setTimeout(() => {
                    if (Math.random() > 0.05) { // 95% success rate
                        const duration = Math.random() * 10 + 5; // 5-15 seconds
                        const size = Math.random() * 500000 + 100000; // 100KB-600KB
                        
                        resolve({
                            success: true,
                            filename: `tts_${Date.now()}.${data.format}`,
                            size: size,
                            duration: duration,
                            format: data.format,
                            voice: data.voice,
                            engine: data.engine
                        });
                    } else {
                        reject(new Error('API simulation failure - please try again'));
                    }
                }, processingTime);
            });
        }

        function handleSuccessfulGeneration(result, text, voice) {
            // Generate a simple beep sound for demo purposes
            const audioUrl = generateDemoAudio();
            elements.audioPlayer.src = audioUrl;
            elements.audioPlayerContainer.classList.remove('hidden');
            
            // Store the audio URL for download
            appState.currentAudio = audioUrl;
            
            // Update audio info
            document.getElementById('audioInfo').innerHTML = `
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="flex justify-between">
                        <span class="font-medium">Size:</span>
                        <span>${(result.size / 1024).toFixed(1)} KB</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">Duration:</span>
                        <span>${result.duration.toFixed(1)}s</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">Format:</span>
                        <span class="uppercase">${result.format}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">Voice:</span>
                        <span>${result.voice}</span>
                    </div>
                </div>
            `;
            
            // Add to recent generations
            addToRecentGenerations({
                text: text.substring(0, 50) + (text.length > 50 ? '...' : ''),
                voice: voice,
                timestamp: new Date().toLocaleTimeString(),
                filename: result.filename,
                duration: result.duration,
                engine: 'gemini'
            });
            
            // Update statistics
            appState.stats.totalGenerations++;
            appState.stats.totalDuration += result.duration;
            updateFavoriteVoice(voice);
            updateSuccessRate();
            
            // Auto-play if enabled
            if (document.getElementById('autoPlay').checked) {
                setTimeout(() => {
                    elements.audioPlayer.play().catch(e => {
                        console.log('Auto-play prevented by browser policy');
                        showNotification('info', 'Audio Ready', 'Click play button to listen to your generated speech.');
                    });
                }, 500);
            } else {
                showNotification('success', 'Audio Generated', 'Your speech is ready to play!');
            }
        }

        function showProgress(show) {
            if (show) {
                elements.progressContainer.classList.remove('hidden');
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 20;
                    if (progress > 90) progress = 90;
                    elements.progressBar.style.width = `${progress}%`;
                    
                    if (elements.progressContainer.classList.contains('hidden')) {
                        clearInterval(interval);
                    }
                }, 300);
            } else {
                elements.progressBar.style.width = '100%';
                setTimeout(() => {
                    elements.progressContainer.classList.add('hidden');
                    elements.progressBar.style.width = '0%';
                }, 300);
            }
        }

        function showHelpModal() {
            elements.helpModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            setTimeout(() => {
                elements.helpModal.classList.add('show');
            }, 10);
        }

        function hideHelpModal() {
            elements.helpModal.classList.remove('show');
            
            setTimeout(() => {
                elements.helpModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 200);
        }

        function showNotification(type, title, message) {
            const iconMap = {
                'success': 'fas fa-check-circle text-emerald-500',
                'error': 'fas fa-exclamation-circle text-red-500',
                'info': 'fas fa-info-circle text-blue-500',
                'warning': 'fas fa-exclamation-triangle text-yellow-500'
            };
            
            document.getElementById('notificationIcon').className = iconMap[type];
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 5000);
        }

        function hideNotification() {
            elements.notification.classList.remove('show');
        }

        function showLoading(show) {
            if (show) {
                elements.loadingOverlay.classList.remove('hidden');
                document.getElementById('loadingText').textContent = 'Generating speech with Gemini AI...';
            } else {
                elements.loadingOverlay.classList.add('hidden');
            }
        }

        function addToRecentGenerations(generation) {
            appState.recentGenerations.unshift(generation);
            if (appState.recentGenerations.length > 5) {
                appState.recentGenerations.pop();
            }
            
            updateRecentList();
            saveRecentGenerations();
        }

        function updateRecentList() {
            if (appState.recentGenerations.length === 0) {
                elements.recentList.innerHTML = '<p class="text-gray-500 text-sm italic text-center py-8">No recent generations</p>';
                return;
            }
            
            elements.recentList.innerHTML = appState.recentGenerations.map(gen => `
                <div class="glass-card p-4 rounded-2xl hover:bg-white hover:bg-opacity-30 transition-all duration-200 cursor-pointer">
                    <div class="text-gray-800 text-sm font-medium mb-2">${gen.text}</div>
                    <div class="text-gray-600 text-xs flex justify-between items-center">
                        <span>${gen.voice}</span>
                        <span class="text-xs bg-emerald-100 text-emerald-600 px-2 py-1 rounded">Gemini</span>
                        <span>${gen.timestamp}</span>
                    </div>
                </div>
            `).join('');
        }

        function clearAll() {
            elements.textInput.value = '';
            updateTextStats();
            elements.audioPlayerContainer.classList.add('hidden');
            
            // Reset sliders
            document.getElementById('speechRate').value = 0;
            document.getElementById('speechPitch').value = 0;
            document.getElementById('temperature').value = 1.0;
            updateRangeValues();
            
            // Reset checkboxes
            document.getElementById('enhanceAudio').checked = false;
            document.getElementById('highQuality').checked = false;
            document.getElementById('autoPlay').checked = false;
            
            showNotification('info', 'Cleared', 'All inputs have been reset.');
        }

        function downloadAudio() {
            if (elements.audioPlayer.src) {
                const a = document.createElement('a');
                a.href = elements.audioPlayer.src;
                a.download = `ai_tts_${Date.now()}.wav`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                showNotification('success', 'Download Started', 'Audio file download has been initiated.');
            } else {
                showNotification('error', 'No Audio', 'No audio file available to download.');
            }
        }

        function shareAudio() {
            if (navigator.share) {
                navigator.share({
                    title: 'AI Generated Speech',
                    text: 'Check out this AI-generated speech!',
                    url: window.location.href
                });
            } else {
                // Fallback for browsers without Web Share API
                navigator.clipboard.writeText(window.location.href);
                showNotification('info', 'Link Copied', 'Share link copied to clipboard.');
            }
        }

        function fetchStatistics() {
            // Simulate fetching updated statistics
            showNotification('info', 'Statistics Updated', 'Latest statistics have been loaded.');
            updateStatistics();
        }

        function updateStatistics() {
            document.getElementById('totalGenerations').textContent = appState.stats.totalGenerations || 0;
            document.getElementById('totalDuration').textContent = `${(appState.stats.totalDuration || 0).toFixed(1)}s`;
            document.getElementById('favoriteVoice').textContent = appState.stats.favoriteVoice || '-';
            document.getElementById('successRate').textContent = `${(appState.stats.successRate || 100).toFixed(1)}%`;
            document.getElementById('errorCount').textContent = appState.stats.errorCount || 0;
        }

        function updateFavoriteVoice(voice) {
            // Simple favorite voice tracking
            appState.stats.favoriteVoice = voice;
        }

        function updateSuccessRate() {
            const total = appState.stats.totalGenerations + appState.stats.errorCount;
            if (total > 0) {
                appState.stats.successRate = (appState.stats.totalGenerations / total) * 100;
            }
        }

        function loadRecentGenerations() {
            const saved = localStorage.getItem('recentGenerations');
            if (saved) {
                try {
                    appState.recentGenerations = JSON.parse(saved);
                    updateRecentList();
                } catch (e) {
                    console.error('Failed to load recent generations:', e);
                }
            }
        }

        function saveRecentGenerations() {
            localStorage.setItem('recentGenerations', JSON.stringify(appState.recentGenerations));
        }

        function loadUserPreferences() {
            const prefs = localStorage.getItem('userPreferences');
            if (prefs) {
                try {
                    const preferences = JSON.parse(prefs);
                    if (preferences.language) elements.languageSelect.value = preferences.language;
                } catch (e) {
                    console.error('Failed to load preferences:', e);
                }
            }
        }

        function savePreferences() {
            const preferences = {
                language: elements.languageSelect.value
            };
            localStorage.setItem('userPreferences', JSON.stringify(preferences));
        }

        function showBatchModal() {
            showNotification('info', 'Coming Soon', 'Batch processing feature will be available soon!');
        }

        function showWelcomeMessage() {
            setTimeout(() => {
                showNotification('info', 'Welcome!', 'Welcome to AI TTS Pro - Enhanced Glassmorphism Edition with 30+ Premium Voices!');
            }, 1000);
        }

        function handleKeyboardShortcuts(e) {
            // Don't trigger shortcuts when modal is open
            if (!elements.helpModal.classList.contains('show')) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'Enter':
                            e.preventDefault();
                            if (!elements.generateBtn.disabled && !appState.isGenerating) {
                                generateSpeech();
                            }
                            break;
                        case '?':
                            e.preventDefault();
                            showHelpModal();
                            break;
                    }
                }
            } else {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    hideHelpModal();
                }
            }
        }

        // Save preferences when changed
        elements.languageSelect.addEventListener('change', savePreferences);

        // Initialize voices on load
        updateVoiceOptions();
    </script>
</body>
</html>
